{% extends 'base.html' %}
{% load static %}

{% block title %}All Products - Candy Shop{% endblock %}

{% block content %}
<section class="products" id="products">

  {% if search_query %}
    {% if products|length == 0 %}
      <p class="products-search-message">
        No products found for "<strong>{{ search_query }}</strong>".</p>
    {% else %}
      <p class="products-search-message">
        Showing results for "<strong>{{ search_query }}</strong>":
      </p>
    {% endif %}
  {% endif %}

  <div id="product-list" class="product-list">
    {% for product in products %}
      <article class="product-card" data-name="{{ product.name|lower }}">
        <img src="{{ product.image_url }}" alt="{{ product.name }}" />

        <div class="product-info">
          <h3>{{ product.name }}</h3>

          {% if product.description %}
            <p>{{ product.description }}</p>
          {% endif %}

          <div class="product-price">
            {{ settings.STRIPE_CURRENCY|default:"USD" }} {{ product.price|floatformat:2 }}
          </div>

          <!-- ✅ Add to Cart: POST-form som faktiskt lägger i cart -->
          <form method="POST" action="{% url 'add_to_cart' %}">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <button type="submit" class="btn-primary">
              Add to Cart
            </button>
          </form>
        </div>
      </article>
    {% endfor %}
  </div>
</section>
{% endblock %}
